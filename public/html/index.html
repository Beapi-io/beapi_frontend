<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
	<title>Beapi > API Docs</title>

	<!-- Meta -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Favicon -->
	<link rel="shortcut icon" href="favicon.ico">
	<script type="text/javascript" src="assets/plugins/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="assets/plugins/jquery/jquery-migrate.min.js"></script>

	<!-- CONFIG -->
	<script type="text/javascript" src="../../config.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

	<!-- Web Fonts -->
	<link rel='stylesheet' type='text/css' href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600&amp;subset=cyrillic,latin'>

	<!-- CSS Global Compulsory -->
	<link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/css/style.css">

	<!-- CSS Header and Footer -->
	<link rel="stylesheet" href="assets/css/headers/header-v6.css">
	<link rel="stylesheet" href="assets/css/footers/footer-v1.css">

	<!-- CSS Implementing Plugins -->
	<link rel="stylesheet" href="assets/plugins/animate.css">
	<link rel="stylesheet" href="assets/plugins/line-icons/line-icons.css">
	<link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/plugins/sky-forms-pro/skyforms/css/sky-forms.css">
	<link rel="stylesheet" href="assets/plugins/sky-forms-pro/skyforms/custom/custom-sky-forms.css">

	<!-- CSS Theme -->
	<link rel="stylesheet" href="assets/css/theme-colors/default.css" id="style_color">
	<link rel="stylesheet" href="assets/css/theme-skins/dark.css">

	<!-- CSS Customization -->
	<link rel="stylesheet" href="assets/css/custom.css">


	<style type="text/css">
	#chartdiv {
		width: 100%;
		height: 500px;
	}
	</style>


	<script>
		var test = localStorage.getItem('token');
		if(test==null){
			window.location = "login.html";
		}
	</script>

</head>

<body class="header-fixed">
<div class="wrapper">
	<!--=== Header v6 ===-->
	<div id="orp_header" class="header-v6 header-white-transparent header-sticky">
	</div>
	<!--=== End Header v6 ===-->

	<!-- Interactive Slider v2 -->
	<div class="interactive-slider-v2 img-v4" style="padding: 50px 0 34px 0;">
		<div class="container">
			<p> </p>
		</div>
	</div>
	<!-- End Interactive Slider v2 -->

	<!--=== Content ===-->

	<div class="container content">
		<!-- Begin Content -->
		<div class="row">

			<div id="index" class="col-lg-12">


				<table width=100% style="border-spacing: 30px;border: solid thin gray;">
					<tr  style="border-spacing: 30px;">
						<td rowspan="2" width="20%">
							<canvas id="doughnut-chart" width="300" height="200"></canvas>
						</td>
						<td style="order: 2px solid #3498db; padding: 15px; text-align: center;">
									<div class="card">
										<div class="card-header bg-success" style=""font-weight: bold;"><h2>200</h2></div>
										<div class="card-body bg-gradient-success">
											10000 reqs
										</div>
									</div>
						</td>
						<td style="order: 2px solid #3498db; padding: 15px; text-align: center;">
									<div class="card">
										<div class="card-header bg-warning" style="font-weight: bold;"><h2>300</h2></div>
										<div class="card-body">
											0 reqs
										</div>
									</div>
						</td>
						<td style="order: 2px solid #3498db; padding: 15px; text-align: center;">
									<div class="card">
										<div class="card-header bg-warning" style="font-weight: bold;"><h2>301</h2></div>
										<div class="card-body">
											0 reqs
										</div>
									</div>
						</td>
						<td style="order: 2px solid #3498db; padding: 15px; text-align: center;">
									<div class="card">
										<div class="card-header bg-warning" style="font-weight: bold;"><h2>302</h2></div>
										<div class="card-body">
											0 reqs
										</div>
									</div>
						</td>
					</tr>
					<tr>
						<td style="order: 2px solid #3498db; padding: 15px; text-align: center;">
							<div class="card">
								<div class="card-header bg-danger" style="font-weight: bold;"><h2>400</h2></div>
								<div class="card-body">
									0 reqs
								</div>
							</div>
						</td>
						<td style="order: 2px solid #3498db; padding: 15px; text-align: center;">
							<div class="card">
								<div class="card-header bg-danger" style="font-weight: bold;"><h2>401</h2></div>
								<div class="card-body">
									0 reqs
								</div>
							</div>
						</td>
						<td style="order: 2px solid #3498db; padding: 15px; text-align: center;">
							<div class="card">
								<div class="card-header bg-danger" style="font-weight: bold;"><h2>402</h2></div>
								<div class="card-body">
									0 reqs
								</div>
							</div>
						</td>
						<td style="order: 2px solid #3498db; padding: 15px; text-align: center;">
							<div class="card">
								<div class="card-header bg-danger" style="font-weight: bold;"><h2>404</h2></div>
								<div class="card-body">
									0 reqs
								</div>
							</div>
						</td>
					</tr>
				</table>


			</div>
		</div>
		<div class="row">
			<!-- Begin Content -->
			<div id="index" class="col-lg-12">
				<canvas id="horbar-chart" height="150"></canvas>
			</div>
		</div>
		<div class="row" >
			<!-- Begin Content -->
			<div id="index" class="col-lg-12">
				<table class="table">
					<thead>
					<tr>
						<th scope="col">Status</th>
						<th scope="col">URI</th>
						<th scope="col">Count</th>
					</tr>
					</thead>
					<tbody>
					<tr>

						<td>200</td>
						<td>/uri/show</td>
						<td>5000</td>
					</tr>
					<tr>
						<td>200</td>
						<td>/hook/create</td>
						<td>500</td>

					</tr>
					<tr>
						<td>200</td>
						<td>/apidoc/show</td>
						<td>25</td>
					</tr>
					</tbody>
				</table>

				<table class="table">
					<thead>
					<tr>
						<th scope="col">Status</th>
						<th scope="col">URI</th>
						<th scope="col">Count</th>
					</tr>
					</thead>
					<tbody>
					<tr>

						<td>400</td>
						<td>/uri/show</td>
						<td>50</td>
					</tr>
					<tr>
						<td>400</td>
						<td>/hook/create</td>
						<td>25</td>

					</tr>
					<tr>
						<td>400</td>
						<td>/apidoc/show</td>
						<td>5</td>
					</tr>
					</tbody>
				</table>
			</div>
		</div>
		<!-- End Content -->
	</div><!--/end container-->

	<!--=== Footer Version 1 ===-->
	<div id="orp_footer" class="footer-v1">
	</div>
	<!--=== End Footer Version 1 ===-->
</div><!--/wrapper-->

<!-- JS Global Compulsory -->
<script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<!-- JS Implementing Plugins -->
<script type="text/javascript" src="assets/plugins/back-to-top.js"></script>
<script type="text/javascript" src="assets/plugins/smoothScroll.js"></script>
<script type="text/javascript" src="assets/js/xml2json.js"></script>
<!-- JS Customization -->
<script type="text/javascript" src="assets/js/custom.js"></script>
<!-- JS Page Level -->
<script type="text/javascript" src="assets/js/app.js"></script>
<script type="text/javascript" src="assets/js/plugins/style-switcher.js"></script>

<script>
function initStats(){
	alert("init stats called");
    var tmp = JSON.parse(window.token);

    var appVersion = "1.0"
    var url = window.url+'/v'+appVersion+'/actuator/stats';

    const data = null;
    const xhr = new XMLHttpRequest();
    xhr.withCredentials = true;

    xhr.addEventListener("readystatechange", function () {
        if(this.readyState === this.DONE){
            switch(this.status) {
              case 200:
                const obj = JSON.parse(this.responseText);

				var totals = {};
				for(uri in obj['stats']){
					console.log(Object.values(obj['stats'][uri])[0][0]);
					if(totals[uri]){

						totals[uri] = totals[uri] + Object.values(obj['stats'][uri])[0][0]
					}else{
						totals[uri] = Object.values(obj['stats'][uri])[0][0]
					}
				}
				alert(JSON.stringify(totals));
				createDonut(totals);
                break;
              case 401:
                  localStorage.removeItem('token');
                  header = "common/nologin_header.html";
                break;
              default:
                stats = this.responseText;
                alert(stats);
            }
        }
    });

    xhr.open("GET", url);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.setRequestHeader("Authorization", "Bearer "+tmp.token);

    xhr.send(data);
}
</script>


<script type="text/javascript">
		var header = null;
		var footer = null;
		var json = null;

		if(localStorage.getItem('token')!=null){
			header = "common/orp_header.html"
			var token = localStorage.getItem('token');
			if(token){
				header = "common/admin_header.html";
			}
		}else{
			window.location.replace('login.html');
		}

		footer = "common/orp_footer.html";
		$(function(){
			// console.log('orp_header loading header...');
			$("#orp_header").load(header);
			$("#orp_footer").load(footer);
		});

		jQuery(document).ready(function() {
			initStats();
			App.init();
			StyleSwitcher.initStyleSwitcher();
		});

		var x2js = new X2JS();
	</script>

	<script>
	function createDonut(totals){
		var keys=[];
		var total=[];
		var currentCode
		alert("totals:"+totals);

		var inc = 0
		for(code in totals){
			if(currentCode==code){
				//add at current position
				total[inc] = total[inc] + totals[code];
			}else{
				keys.push(code)
				currentCode=code;
				inc++;
				total.push(totals[code]);
			}
		}

		alert(JSON.stringify(keys));
		alert(total);

		new Chart(document.getElementById("doughnut-chart"), {
			type: 'doughnut',
			data: {
			  labels: keys,
			  datasets: [
				{
				  label: "Requests",
				  data: total
				}
			  ]
			},
			options: {
			  title: {
				display: true,
				text: 'Predicted world population (millions) in 2050'
			  }
			}
		});
	}

		new Chart(document.getElementById('horbar-chart').getContext('2d'), {
		  type: 'bar',
		  data: {
			labels: ['/user/show', '/hook/create', '/apidoc/show'],
			datasets: [{
			  label: 'Requests per Endpoint',
			  data: [3000,250,10],
			}],
		  },
		  options: {
		  	maintainAspectRatio: false,
			indexAxis: 'y', // <-- here
			responsive: true
		  }
		});
	</script>
<!--[if lt IE 9]>
<script src="assets/plugins/respond.js"></script>
<script src="assets/plugins/html5shiv.js"></script>
<script src="assets/plugins/placeholder-IE-fixes.js"></script>
<![endif]-->

</body>
</html>
